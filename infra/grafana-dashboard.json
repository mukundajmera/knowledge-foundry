{
    "annotations": {
        "list": [
            {
                "datasource": "-- Grafana --",
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Deployments",
                "type": "dashboard"
            }
        ]
    },
    "description": "Knowledge Foundry ‚Äî API Performance & Quality Dashboard",
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 1,
    "id": null,
    "links": [],
    "liveNow": false,
    "panels": [
        {
            "title": "üî¢ Request Rate (QPS)",
            "type": "timeseries",
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 0
            },
            "targets": [
                {
                    "expr": "rate(http_requests_total{service=\"kf-api\"}[1m])",
                    "legendFormat": "{{method}} {{handler}}"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "unit": "reqps",
                    "thresholds": {
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            },
                            {
                                "color": "yellow",
                                "value": 400
                            },
                            {
                                "color": "red",
                                "value": 500
                            }
                        ]
                    }
                }
            }
        },
        {
            "title": "‚è±Ô∏è Response Latency (p50 / p95 / p99)",
            "type": "timeseries",
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 0
            },
            "targets": [
                {
                    "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket{service=\"kf-api\"}[5m]))",
                    "legendFormat": "p50"
                },
                {
                    "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{service=\"kf-api\"}[5m]))",
                    "legendFormat": "p95"
                },
                {
                    "expr": "histogram_quantile(0.99, rate(http_request_duration_seconds_bucket{service=\"kf-api\"}[5m]))",
                    "legendFormat": "p99"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "unit": "s",
                    "thresholds": {
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            },
                            {
                                "color": "yellow",
                                "value": 0.3
                            },
                            {
                                "color": "red",
                                "value": 0.5
                            }
                        ]
                    }
                }
            }
        },
        {
            "title": "‚ùå Error Rate (%)",
            "type": "stat",
            "gridPos": {
                "h": 4,
                "w": 6,
                "x": 0,
                "y": 8
            },
            "targets": [
                {
                    "expr": "100 * rate(http_requests_total{status=~\"5..\",service=\"kf-api\"}[5m]) / rate(http_requests_total{service=\"kf-api\"}[5m])",
                    "legendFormat": "Error %"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "unit": "percent",
                    "thresholds": {
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            },
                            {
                                "color": "yellow",
                                "value": 1
                            },
                            {
                                "color": "red",
                                "value": 5
                            }
                        ]
                    }
                }
            }
        },
        {
            "title": "üí∞ Avg Cost per Query ($)",
            "type": "stat",
            "gridPos": {
                "h": 4,
                "w": 6,
                "x": 6,
                "y": 8
            },
            "targets": [
                {
                    "expr": "avg(kf_query_cost_usd)",
                    "legendFormat": "Avg Cost"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "unit": "currencyUSD",
                    "thresholds": {
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            },
                            {
                                "color": "yellow",
                                "value": 0.06
                            },
                            {
                                "color": "red",
                                "value": 0.10
                            }
                        ]
                    }
                }
            }
        },
        {
            "title": "üéØ Cache Hit Rate (%)",
            "type": "gauge",
            "gridPos": {
                "h": 4,
                "w": 6,
                "x": 12,
                "y": 8
            },
            "targets": [
                {
                    "expr": "100 * rate(kf_cache_hits_total[5m]) / (rate(kf_cache_hits_total[5m]) + rate(kf_cache_misses_total[5m]))",
                    "legendFormat": "Cache Hit %"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "unit": "percent",
                    "min": 0,
                    "max": 100,
                    "thresholds": {
                        "steps": [
                            {
                                "color": "red",
                                "value": null
                            },
                            {
                                "color": "yellow",
                                "value": 50
                            },
                            {
                                "color": "green",
                                "value": 75
                            }
                        ]
                    }
                }
            }
        },
        {
            "title": "ü§ñ Model Usage Distribution",
            "type": "piechart",
            "gridPos": {
                "h": 4,
                "w": 6,
                "x": 18,
                "y": 8
            },
            "targets": [
                {
                    "expr": "sum by (model) (rate(kf_model_requests_total[5m]))",
                    "legendFormat": "{{model}}"
                }
            ]
        },
        {
            "title": "üèóÔ∏è Active Pods",
            "type": "stat",
            "gridPos": {
                "h": 4,
                "w": 4,
                "x": 0,
                "y": 12
            },
            "targets": [
                {
                    "expr": "count(up{job=\"knowledge-foundry-api\"} == 1)",
                    "legendFormat": "Healthy Pods"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "thresholds": {
                        "steps": [
                            {
                                "color": "red",
                                "value": null
                            },
                            {
                                "color": "yellow",
                                "value": 2
                            },
                            {
                                "color": "green",
                                "value": 3
                            }
                        ]
                    }
                }
            }
        },
        {
            "title": "üìä RAGAS Faithfulness (latest eval)",
            "type": "stat",
            "gridPos": {
                "h": 4,
                "w": 4,
                "x": 4,
                "y": 12
            },
            "targets": [
                {
                    "expr": "kf_ragas_faithfulness",
                    "legendFormat": "Faithfulness"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "unit": "percentunit",
                    "thresholds": {
                        "steps": [
                            {
                                "color": "red",
                                "value": null
                            },
                            {
                                "color": "yellow",
                                "value": 0.90
                            },
                            {
                                "color": "green",
                                "value": 0.95
                            }
                        ]
                    }
                }
            }
        },
        {
            "title": "üìä Context Precision (latest eval)",
            "type": "stat",
            "gridPos": {
                "h": 4,
                "w": 4,
                "x": 8,
                "y": 12
            },
            "targets": [
                {
                    "expr": "kf_ragas_context_precision",
                    "legendFormat": "Context Precision"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "unit": "percentunit",
                    "thresholds": {
                        "steps": [
                            {
                                "color": "red",
                                "value": null
                            },
                            {
                                "color": "yellow",
                                "value": 0.85
                            },
                            {
                                "color": "green",
                                "value": 0.90
                            }
                        ]
                    }
                }
            }
        },
        {
            "title": "üìà Request Duration Heatmap",
            "type": "heatmap",
            "gridPos": {
                "h": 8,
                "w": 24,
                "x": 0,
                "y": 16
            },
            "targets": [
                {
                    "expr": "rate(http_request_duration_seconds_bucket{service=\"kf-api\"}[5m])",
                    "legendFormat": "{{le}}"
                }
            ],
            "options": {
                "calculate": false,
                "color": {
                    "scheme": "Spectral",
                    "fill": "dark-orange"
                }
            }
        }
    ],
    "refresh": "10s",
    "schemaVersion": 39,
    "tags": [
        "knowledge-foundry",
        "api",
        "production"
    ],
    "templating": {
        "list": []
    },
    "time": {
        "from": "now-1h",
        "to": "now"
    },
    "timepicker": {},
    "timezone": "browser",
    "title": "Knowledge Foundry ‚Äî API Dashboard",
    "uid": "kf-api-dashboard",
    "version": 1
}